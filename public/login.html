<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Entrar</title>
<style>body{font-family:Arial,Helvetica,sans-serif;background:#1C1C1C;color:#FFFFFF}.box{max-width:420px;margin:40px auto;padding:20px;background:#2A2A2A;border-radius:8px}input{width:100%;padding:8px;margin:6px 0;border-radius:6px;border:1px solid #3A3A3A;background:#1C1C1C;color:#FFFFFF}button{background:#FF8C00;color:#1C1C1C;padding:10px 15px;border-radius:8px;border:none;cursor:pointer;font-weight:600;width:100%;margin-top:10px}</style></head><body>
<div class="box"><h2>Entrar</h2>
<form id="f">
<label>Login (sem @npmstart.com)</label><input name="emailLocal" required/>
<label>Senha</label><input type="password" name="password" required/>
<button type="submit">Entrar</button>
</form>
<p id="msg"></p>
</div>
<script>
// Preencher os campos com dados da URL, se disponÃ­veis
window.addEventListener('DOMContentLoaded', () => {
  const urlParams = new URLSearchParams(window.location.search);
  const login = urlParams.get('login');
  const password = urlParams.get('password');
  
  if (login) {
    document.querySelector('input[name="emailLocal"]').value = login;
  }
  
  if (password) {
    document.querySelector('input[name="password"]').value = password;
  }
});

document.getElementById('f').addEventListener('submit', async e => {
  e.preventDefault();
  const fd = new FormData(e.target);
  const body = { emailLocal: fd.get('emailLocal'), password: fd.get('password') };
  const r = await fetch('/api/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
  const j = await r.json();
  if (j.ok) { localStorage.setItem('token', j.token); localStorage.setItem('user', JSON.stringify(j.user)); alert('Logado'); location.href='/'; }
  else document.getElementById('msg').innerText = j.error || JSON.stringify(j);
});
</script>
</body></html>